---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.astro";
import GridItem from "../components/GridItem.astro";
import TextBlock from "../components/TextBlock.astro";
import { getCollection } from "astro:content";

const videos = await getCollection("videos");

// Sort videos by date (newest first)
const sortedVideos = videos.sort(
	(a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);

// Helper for date formatting
const formatDate = (date: Date) => {
	return new Intl.DateTimeFormat("en-US", {
		year: "numeric",
		month: "long",
		day: "numeric",
	}).format(date);
};

// Dummy Data for Mixed Grid
const newsItems = [
	{
		title: "The Iron Claw: Behind the Scenes",
		date: "October 12, 2023",
		link: "#",
		image: "https://images.unsplash.com/photo-1574352067721-72d5913ee35c?q=80&w=1000&auto=format&fit=crop",
	},
	{
		title: "A24 x Online Ceramics Drop 002",
		date: "September 28, 2023",
		link: "#",
		image: "https://images.unsplash.com/photo-1523381210434-271e8be1f52b?q=80&w=1000&auto=format&fit=crop",
	},
];

const shopItems = [
	{
		title: "Logo Tee - Black",
		price: "$45.00",
		link: "#",
		image: "https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?q=80&w=1000&auto=format&fit=crop",
	},
	{
		title: "Zine Issue #12",
		price: "$15.00",
		link: "#",
		image: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?q=80&w=1000&auto=format&fit=crop",
	},
];

// Featured Video (Newest)
const featuredVideo = sortedVideos[0];
const remainingVideos = sortedVideos.slice(1);
---

<Layout title="Johan Toast">
	<main class="min-h-screen bg-black text-white pb-20">
		{/* Full Screen Hero with the latest video or custom content */}
		{
			featuredVideo ? (
				<Hero
					title={featuredVideo.data.title}
					subtitle="New Release"
					ctaLink={`/video/${featuredVideo.slug}`}
					image="https://images.unsplash.com/photo-1536440136628-849c177e76a1?q=80&w=2525&auto=format&fit=crop"
				/>
			) : (
				<Hero title="Johan Toast" subtitle="Visuals" />
			)
		}

		{/* Minimal Header (Sticky?) or just section break */}
		<div
			class="container mx-auto px-4 py-8 mb-8 border-b border-white/20 flex justify-between items-end"
		>
			<h1
				class="text-xs font-mono uppercase tracking-widest text-gray-500"
			>
				Latest Updates
			</h1>
			<span
				class="text-xs font-mono uppercase tracking-widest text-[#ff208a]"
			>
				Scroll Down
			</span>
		</div>

		{/* Mixed Grid Layout */}
		<div class="container mx-auto px-4">
			<div
				class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-x-6 gap-y-16"
			>
				{/* 1. First batch of videos */}
				{
					remainingVideos
						.slice(0, 2)
						.map((video) => (
							<GridItem
								type="video"
								title={video.data.title}
								subtitle={formatDate(video.data.date)}
								link={`/video/${video.slug}`}
								isProtected={video.data.is_protected}
								spanClass="col-span-1 md:col-span-2 lg:col-span-2"
							/>
						))
				}

				{/* 2. Shop Item (Portrait) */}
				<GridItem
					type="shop"
					title={shopItems[0].title}
					subtitle={shopItems[0].price}
					link={shopItems[0].link}
					image={shopItems[0].image}
					spanClass="col-span-1 row-span-2 hidden lg:block"
					Tall
					item
				/>

				{/* 3. News Item */}
				<GridItem
					type="news"
					title={newsItems[0].title}
					subtitle={newsItems[0].date}
					link={newsItems[0].link}
					image={newsItems[0].image}
					spanClass="col-span-1"
				/>

				{/* Typographic Break */}
				<div
					class="col-span-1 md:col-span-2 lg:col-span-4 border-t border-b border-white/10 my-8"
				>
					<TextBlock text="Originals" subtext="Selected Works" />
				</div>

				{/* 4. More Videos */}
				{
					remainingVideos
						.slice(2)
						.map((video) => (
							<GridItem
								type="video"
								title={video.data.title}
								subtitle={formatDate(video.data.date)}
								link={`/video/${video.slug}`}
								isProtected={video.data.is_protected}
								spanClass="col-span-1"
							/>
						))
				}

				{/* 5. Another Shop Item */}
				<GridItem
					type="shop"
					title={shopItems[1].title}
					subtitle={shopItems[1].price}
					link={shopItems[1].link}
					image={shopItems[1].image}
					spanClass="col-span-1"
				/>

				{/* 6. Another News Item */}
				<GridItem
					type="news"
					title={newsItems[1].title}
					subtitle={newsItems[1].date}
					link={newsItems[1].link}
					image={newsItems[1].image}
					spanClass="col-span-1 md:col-span-2"
				/>
			</div>
		</div>

		{/* Footer Text Block */}
		<TextBlock
			text="Johan Toast"
			subtext="Established 2024"
			align="center"
		/>
	</main>
</Layout>
